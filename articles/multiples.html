<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multiple Simulations • epicrop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multiple Simulations">
<meta property="og:description" content="epicrop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epicrop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9018</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/epicrop.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mapping.html">Mapping Simulations</a>
    </li>
    <li>
      <a href="../articles/multiples.html">Multiple Simulations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adamhsparks/epicrop/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="multiples_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multiple Simulations</h1>
                        <h4 class="author">Adam H. Sparks</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/adamhsparks/epicrop/blob/master/vignettes/multiples.Rmd"><code>vignettes/multiples.Rmd</code></a></small>
      <div class="hidden name"><code>multiples.Rmd</code></div>

    </div>

    
    
<!-- STOP! Do not edit this file. This file is generated from multiples.Rmd.orig -->
<p>You may wish to compare the effects of different establishment dates, different seasons or different locations on disease levels. This vignette details how you can automate several runs of <em>epicrop</em> in R and visualise them. Examples are given that show how to run the process sequentially and in parallel, decreasing the runtime necessary and how to benchmark your processes to help optimise your workflow.</p>
<div id="multiple-seasons" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-seasons" class="anchor"></a>Multiple seasons</h2>
<div id="fetching-nasa-power-data-for-multiple-seasons" class="section level3">
<h3 class="hasAnchor">
<a href="#fetching-nasa-power-data-for-multiple-seasons" class="anchor"></a>Fetching NASA POWER data for multiple seasons</h3>
<p>Start by creating a list of the dates representing the seasons that you want to simulate. In this case, since we specify the duration of the season, there is no need to explicitly state the end-date, that will automatically be determined by <code><a href="../reference/get_wth.html">get_wth()</a></code> with the <code>duration</code> argument that we pass along in the <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code>. You can use as many start dates, representing as many seasons as you desire, but for the purposes of speed in this vignette, only two will be used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2001</span>
<span class="va">seasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">years</span>, <span class="st">"-06-30"</span><span class="op">)</span></code></pre></div>
<p>Next use <code><a href="../reference/get_wth.html">get_wth()</a></code> to fetch the weather data from the <a href="https://power.larc.nasa.gov">POWER API</a>. In this example we will use the IRRI Zeigler Experiment Station coordinates as shown in the example for <code><a href="../reference/get_wth.html">get_wth()</a></code>. With the vector of establishment dates, <code>seasons</code>, use <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code> to fetch all of the seasons with one function. You could also use R’s base <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> here as well if you prefer.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/adamhsparks/epicrop/">"epicrop"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://purrr.tidyverse.org">"purrr"</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'purrr'</span>
<span class="co">#&gt; The following object is masked from 'package:epicrop':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     transpose</span>

<span class="va">seasons_wth</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">seasons</span>,
    .f <span class="op">=</span> <span class="va">get_wth</span>,
    lonlat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">121.255669</span>, <span class="fl">14.16742</span><span class="op">)</span>,
    duration <span class="op">=</span> <span class="fl">120</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="using-purrr-to-simplify-the-simulation-of-multiple-seasons" class="section level3">
<h3 class="hasAnchor">
<a href="#using-purrr-to-simplify-the-simulation-of-multiple-seasons" class="anchor"></a>Using <em>purrr</em> to simplify the simulation of multiple seasons</h3>
<p>Now that we have a list of weather data for two seasons we will use <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_df()</a></code> now to run <code><a href="../reference/predict_bacterial_blight.html">predict_bacterial_blight()</a></code> for two seasons and create a single data frame of the two seasons. Using <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code> as above would return a list of two data frames, if you wish. This behaviour would be the same as if you used R’s base <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> here as well.</p>
<p>Add a column to specify the season, in this case we only have wet seasons for two years, but if you have multiple seasons per year, you can still use this template, <em>e.g.</em>, for multiple seasons in one year, use <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">lubridate::ymd()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://lubridate.tidyverse.org">"lubridate"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://rapporter.github.io/pander/">"pander"</a></span><span class="op">)</span>

<span class="va">seasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span>
  .x <span class="op">=</span> <span class="va">seasons_wth</span>,
  .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/predict_bacterial_blight.html">predict_bacterial_blight</a></span><span class="op">(</span>emergence <span class="op">=</span> <span class="va">.x</span><span class="op">$</span><span class="va">YYYYMMDD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
                                  wth <span class="op">=</span> <span class="va">.x</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2000</span> <span class="op">~</span> <span class="fl">2000</span>,
                            <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2001</span> <span class="op">~</span> <span class="fl">2001</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">AUDPC</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">AUDPC</span>, <span class="va">season</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="va">seasons</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center">season</th>
<th align="center">AUDPC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">2000</td>
<td align="center">11.12</td>
</tr>
<tr class="even">
<td align="center">2001</td>
<td align="center">5.94</td>
</tr>
</tbody>
</table>
</div>
<div id="visualising-differences-in-audpc-between-seasons" class="section level3">
<h3 class="hasAnchor">
<a href="#visualising-differences-in-audpc-between-seasons" class="anchor"></a>Visualising differences in AUDPC between seasons</h3>
<p>A simple bar chart created using <em>ggplot2</em> is an effective way to visualise the difference between the two seasons.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">seasons</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span>,
           x <span class="op">=</span> <span class="va">AUDPC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span>,
           orientation <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Season"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="graph_seasons-1.png" alt=""><p class="caption">Bacterial blight area under the disease progress curve (AUDPC) for the 2000 and 2001 wet seasons at the IRRI Zeigler Experiment Station in Calabarzon, Philippines.</p>
</div>
</div>
<div id="simulating-multiple-seasons-with-furrr-using-parallel-processing" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating-multiple-seasons-with-furrr-using-parallel-processing" class="anchor"></a>Simulating multiple seasons with <em>furrr</em> using parallel processing</h3>
<p>Using <em>furrr</em>, we can do the same thing in parallel to reduce the runtime, especially if you have several seasons.</p>
<div id="a-note-on-the-use-of-parallel-processing" class="section level4">
<h4 class="hasAnchor">
<a href="#a-note-on-the-use-of-parallel-processing" class="anchor"></a>A note on the use of parallel processing</h4>
<p>Use parallel processing with caution. <em>epicrop</em> is highly optimised for speed (as much as pure R can be). For small runs, <em>e.g.</em> one or two seasons or locations, this is will not reduce the time and may increase the run time due to overhead setting up and running the parallel processing. Best guess is that unless you have &gt; 40 or 50 seasons or locations or some combinations thereof; to run the processes in parallel will not be any benefit.</p>
<p>In this case, while this code runs, you can benchmark it and see that this is no faster and in some cases, slower than running the code sequentially. An example of <a href="Comparing-sequential-versus-parallel-methods">benchmarking</a> code is provided below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/adamhsparks/epicrop/">"epicrop"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/DavisVaughan/furrr">"furrr"</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: future</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://lubridate.tidyverse.org">"lubridate"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://rapporter.github.io/pander/">"pander"</a></span><span class="op">)</span>

<span class="co"># Respect the API server and use 1 core</span>
<span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2001</span>
<span class="va">seasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">years</span>, <span class="st">"-06-30"</span><span class="op">)</span>
<span class="va">seasons_wth</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map</a></span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">seasons</span>,
    .f <span class="op">=</span> <span class="va">get_wth</span>,
    lonlat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">121.255669</span>, <span class="fl">14.16742</span><span class="op">)</span>,
    duration <span class="op">=</span> <span class="fl">120</span>,
    .options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/furrr_options.html">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># for local processing use 2 cores, this will assign one to each year, if you</span>
<span class="co"># have more years and more cores, e.g., an HPC, explore using more resources</span>

<span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="co"># run predict_bacterial_blight() over the data frames of weather</span>
<span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dfr</a></span><span class="op">(</span>
  .x <span class="op">=</span> <span class="va">seasons_wth</span>,
  .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/predict_bacterial_blight.html">predict_bacterial_blight</a></span><span class="op">(</span>emergence <span class="op">=</span> <span class="va">.x</span><span class="op">$</span><span class="va">YYYYMMDD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
                                  wth <span class="op">=</span> <span class="va">.x</span><span class="op">)</span>,
  .options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/furrr_options.html">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2000</span> <span class="op">~</span> <span class="fl">2000</span>,
                            <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2001</span> <span class="op">~</span> <span class="fl">2001</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">AUDPC</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">AUDPC</span>, <span class="va">season</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error: there is no package called ‘epicrop’</span>
<span class="co">#&gt; Error in if (tail(stdout, 1) == "") {: argument is of length zero</span></code></pre></div>
<p>We can see here that the AUDPC values match using both processing methods.</p>
</div>
</div>
</div>
<div id="multiple-establishment-dates" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-establishment-dates" class="anchor"></a>Multiple establishment dates</h2>
<div id="using-purrr-to-simulate-multiple-establishment-dates" class="section level3">
<h3 class="hasAnchor">
<a href="#using-purrr-to-simulate-multiple-establishment-dates" class="anchor"></a>Using <em>purrr</em> to simulate multiple establishment dates</h3>
<p>To simulate multiple establishment dates and across multiple years at the same time we can use <code><a href="https://purrr.tidyverse.org/reference/cross.html">purrr::cross2()</a></code> to create a vector of all year and month-day combinations that we wish to simulate.</p>
<p>Simplifying the weather data, we will only use the first date of each year and fetch weather data using the <code>duration</code> option, specifying 180 days. This gives six months of data and extends to the end and a bit beyond the last growing season of the final establishment date, “01-31”. <code><a href="../reference/predict_bacterial_blight.html">predict_bacterial_blight()</a></code> will take the full six months of weather data and subset for the respective growing seasons, selecting only the necessary weather data.</p>
<p>Using <code><a href="https://purrr.tidyverse.org/reference/map2.html">purrr::map2</a></code> allows for using two variables, one for weather data, <code>wth</code>, and one for the emergence/establishment dates, <code>emergence_dates</code>. This returns a list of data, but using <code>dplyr::bind_rows(.id = "emergence")</code> creates a data frame with a column of emergence/establishment dates that can be used for grouping the data for further analysis or visualisation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/adamhsparks/epicrop/">"epicrop"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://purrr.tidyverse.org">"purrr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://lubridate.tidyverse.org">"lubridate"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://rapporter.github.io/pander/">"pander"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/DavisVaughan/furrr">"furrr"</a></span><span class="op">)</span>

<span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">2001</span><span class="op">:</span><span class="fl">2010</span>
<span class="va">month_day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-06-01"</span>, <span class="st">"-06-14"</span>, <span class="st">"-06-30"</span><span class="op">)</span>
<span class="va">emergence_dates</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/cross.html">cross2</a></span><span class="op">(</span><span class="va">years</span>, <span class="va">month_day</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">paste0</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Respect the API server and use 1 core</span>
<span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co"># create a vector of dates for weather data.</span>
<span class="co"># Only take the earliest establishment date, then extend the duration out past</span>
<span class="co"># 120 days from final establishment date.</span>
<span class="co"># Here just taking 180 days, 6 months, works well.</span>
<span class="va">wth_start_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">years</span>, <span class="va">month_day</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>

<span class="va">seasons_wth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span>
  .x <span class="op">=</span> <span class="va">wth_start_dates</span>,
  .f <span class="op">=</span> <span class="va">get_wth</span>,
  lonlat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">121.255669</span>, <span class="fl">14.16742</span><span class="op">)</span>,
  duration <span class="op">=</span> <span class="fl">180</span>
<span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>YYYYMMDD <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="va">YYYYMMDD</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Now use 4 cores for the local processing</span>
<span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="co"># Once we have all the weather, create a list of weather data.frames for each</span>
<span class="co"># establishment date</span>
<span class="co"># Create time intervals to subset the weather data, creating a list new</span>
<span class="co"># data.frames for each establishment date.</span>

<span class="va">wth</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">emergence_dates</span>,
      .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">seasons_wth</span>, <span class="va">YYYYMMDD</span> <span class="op">&gt;=</span> <span class="va">.x</span> <span class="op">&amp;</span>
                      <span class="va">YYYYMMDD</span> <span class="op">&lt;=</span> <span class="va">.x</span> <span class="op">+</span> <span class="fl">120</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">emergence_dates</span><span class="op">)</span>

<span class="va">multi_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span>
  .x <span class="op">=</span> <span class="va">wth</span>,
  .y <span class="op">=</span> <span class="va">emergence_dates</span>,
  .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/predict_bacterial_blight.html">predict_bacterial_blight</a></span><span class="op">(</span>emergence <span class="op">=</span> <span class="va">.y</span>,
                                  wth <span class="op">=</span> <span class="va">.x</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"emergence"</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">emergence</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">emergence</span>, <span class="va">AUDPC</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">AUDPC</span>, <span class="va">emergence</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="va">multi_dates</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="18%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="center">emergence</th>
<th align="center">AUDPC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">2001-06-01</td>
<td align="center">11.75</td>
</tr>
<tr class="even">
<td align="center">2001-06-14</td>
<td align="center">6.976</td>
</tr>
<tr class="odd">
<td align="center">2001-06-30</td>
<td align="center">5.94</td>
</tr>
<tr class="even">
<td align="center">2002-06-01</td>
<td align="center">12.47</td>
</tr>
<tr class="odd">
<td align="center">2002-06-14</td>
<td align="center">10.45</td>
</tr>
<tr class="even">
<td align="center">2002-06-30</td>
<td align="center">12.19</td>
</tr>
<tr class="odd">
<td align="center">2003-06-01</td>
<td align="center">10.18</td>
</tr>
<tr class="even">
<td align="center">2003-06-14</td>
<td align="center">10.58</td>
</tr>
<tr class="odd">
<td align="center">2003-06-30</td>
<td align="center">15.26</td>
</tr>
<tr class="even">
<td align="center">2004-06-01</td>
<td align="center">10.3</td>
</tr>
<tr class="odd">
<td align="center">2004-06-14</td>
<td align="center">13.29</td>
</tr>
<tr class="even">
<td align="center">2004-06-30</td>
<td align="center">10.19</td>
</tr>
<tr class="odd">
<td align="center">2005-06-01</td>
<td align="center">14.29</td>
</tr>
<tr class="even">
<td align="center">2005-06-14</td>
<td align="center">13.86</td>
</tr>
<tr class="odd">
<td align="center">2005-06-30</td>
<td align="center">15.1</td>
</tr>
<tr class="even">
<td align="center">2006-06-01</td>
<td align="center">15.06</td>
</tr>
<tr class="odd">
<td align="center">2006-06-14</td>
<td align="center">14.01</td>
</tr>
<tr class="even">
<td align="center">2006-06-30</td>
<td align="center">12.62</td>
</tr>
<tr class="odd">
<td align="center">2007-06-01</td>
<td align="center">7.811</td>
</tr>
<tr class="even">
<td align="center">2007-06-14</td>
<td align="center">7.173</td>
</tr>
<tr class="odd">
<td align="center">2007-06-30</td>
<td align="center">10.91</td>
</tr>
<tr class="even">
<td align="center">2008-06-01</td>
<td align="center">9.31</td>
</tr>
<tr class="odd">
<td align="center">2008-06-14</td>
<td align="center">8.957</td>
</tr>
<tr class="even">
<td align="center">2008-06-30</td>
<td align="center">10.27</td>
</tr>
<tr class="odd">
<td align="center">2009-06-01</td>
<td align="center">4.83</td>
</tr>
<tr class="even">
<td align="center">2009-06-14</td>
<td align="center">9.118</td>
</tr>
<tr class="odd">
<td align="center">2009-06-30</td>
<td align="center">6.797</td>
</tr>
<tr class="even">
<td align="center">2010-06-01</td>
<td align="center">13.95</td>
</tr>
<tr class="odd">
<td align="center">2010-06-14</td>
<td align="center">16.31</td>
</tr>
<tr class="even">
<td align="center">2010-06-30</td>
<td align="center">16</td>
</tr>
</tbody>
</table>
<p>That’s a bit long and there’s lots of values to digest here.</p>
</div>
<div id="visualising-multiple-establishment-dates-using-a-stem-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#visualising-multiple-establishment-dates-using-a-stem-plot" class="anchor"></a>Visualising multiple establishment dates using a stem plot</h3>
<p>A bar chart as with the previous example works, but it can be simplified and made more clear using a stem plot created with <em>ggplot2</em>. Using <code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">ggplot2::geom_segment()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">ggplot2::geom_point()</a></code> we can maximise the ink to information ratio and create an easy to view and interpret graph of these data.</p>
<p>Note the additional <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">ggplot2::aes()</a></code> parameters here, <code>xend</code> and <code>yend</code> are necessary since we’re using <code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">ggplot2::geom_segment()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">multi_dates</span>,
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
         x <span class="op">=</span> <span class="va">AUDPC</span>,
         xend <span class="op">=</span> <span class="fl">0</span>,
         y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">emergence</span><span class="op">)</span>,
         yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">emergence</span><span class="op">)</span>
       <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">rev</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Establishment Date"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="stem-plot-1.png" alt=""><p class="caption">Rice bacterial blight area under the disease progress curve (AUDPC) values for three establishment dates over ten years at the IRRI Zeigler Experiment Station in Calabarzon, Philipppines.</p>
</div>
</div>
<div id="using-furrr-to-run-multiple-establishment-dates-in-parallel" class="section level3">
<h3 class="hasAnchor">
<a href="#using-furrr-to-run-multiple-establishment-dates-in-parallel" class="anchor"></a>Using <em>furrr</em> to run multiple establishment dates in parallel</h3>
<p>To run the previous example in parallel, substitute <em>furrr</em> equivalent functions for the <em>purrr</em> functions used above. These are easily identified by the <code>future_</code> prefix on each of the functions where they are used.</p>
<p>In this example rather than printing the whole table, the data are piped directly into the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot2::ggplot()</a></code> function for creating a figure that again, is the same as the previous example, but run in parallel using <em>furrr</em>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/DavisVaughan/furrr">"furrr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://purrr.tidyverse.org">"purrr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://lubridate.tidyverse.org">"lubridate"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/adamhsparks/epicrop/">"epicrop"</a></span><span class="op">)</span>

<span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">years</span> <span class="op">&lt;-</span> <span class="fl">2001</span><span class="op">:</span><span class="fl">2010</span>
<span class="va">month_day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-06-01"</span>, <span class="st">"-06-14"</span>, <span class="st">"-06-30"</span><span class="op">)</span>
<span class="va">emergence_dates</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/cross.html">cross2</a></span><span class="op">(</span><span class="va">years</span>, <span class="va">month_day</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">paste0</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># create a vector of dates for weather data.</span>
<span class="co"># Only take the earliest establishment date, then extend the duration out past</span>
<span class="co"># 120 days from final establishment date.</span>
<span class="co"># Here just taking 180 days, 6 months, works well.</span>
<span class="va">wth_start_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">years</span>, <span class="va">month_day</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>

<span class="va">seasons_wth</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map_dfr</a></span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">wth_start_dates</span>,
    .f <span class="op">=</span> <span class="va">get_wth</span>,
    lonlat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">121.255669</span>, <span class="fl">14.16742</span><span class="op">)</span>,
    duration <span class="op">=</span> <span class="fl">180</span>,
    .options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/furrr_options.html">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>YYYYMMDD <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="va">YYYYMMDD</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Once we have all the weather, create a list of weather data.frames for each</span>
<span class="co"># establishment date</span>
<span class="co"># Create time intervals to subset the weather data, creating a list new</span>
<span class="co"># data.frames for each establishment date.</span>

<span class="co"># Now use 4 cores for the local processing</span>
<span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="va">wth</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map.html">future_map</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">emergence_dates</span>,
             .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">seasons_wth</span>, <span class="va">YYYYMMDD</span> <span class="op">&gt;=</span> <span class="va">.x</span> <span class="op">&amp;</span>
                             <span class="va">YYYYMMDD</span> <span class="op">&lt;=</span> <span class="va">.x</span> <span class="op">+</span> <span class="fl">120</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">emergence_dates</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map2.html">future_map2</a></span><span class="op">(</span>
  .x <span class="op">=</span> <span class="va">wth</span>,
  .y <span class="op">=</span> <span class="va">emergence_dates</span>,
  .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/predict_bacterial_blight.html">predict_bacterial_blight</a></span><span class="op">(</span>emergence <span class="op">=</span> <span class="va">.y</span>,
                                  wth <span class="op">=</span> <span class="va">.x</span><span class="op">)</span>,
  .options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/furrr_options.html">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"emergence"</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">emergence</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">emergence</span>, <span class="va">AUDPC</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">AUDPC</span>, <span class="va">emergence</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">AUDPC</span>,
    xend <span class="op">=</span> <span class="fl">0</span>,
    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">emergence</span><span class="op">)</span>,
    yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">emergence</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">rev</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Establishment Date"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error: there is no package called ‘epicrop’</span></code></pre></div>
</div>
</div>
<div id="multiple-locations" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-locations" class="anchor"></a>Multiple locations</h2>
<div id="using-purrr-to-simulate-multiple-locations" class="section level3">
<h3 class="hasAnchor">
<a href="#using-purrr-to-simulate-multiple-locations" class="anchor"></a>Using <em>purrr</em> to simulate multiple locations</h3>
<p>Multiple locations will look much like the previous example for multiple seasons (years) but a vector of latitude and longitude values are provided to <code><a href="../reference/get_wth.html">get_wth()</a></code>. In this example we will fetch data for the Mekong River Delta and Red River Delta in Vietnam; Prachin Buri, Thailand; Chennai, India and Nueva Ecija, in the Philippines for the wet season (second half of the year) in 2000.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="st">"Mekong River"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">105.5943</span>, <span class="fl">10.0634</span><span class="op">)</span>,
  <span class="st">"Red River"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">105.9700</span>, <span class="fl">20.9034</span><span class="op">)</span>,
  <span class="st">"Prachin Buri"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">101.6601</span>, <span class="fl">14.0421</span><span class="op">)</span>,
  <span class="st">"Chennai"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">80.2707</span>, <span class="fl">13.0827</span><span class="op">)</span>,
  <span class="st">"Neuva Ecija"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">121.1113</span>, <span class="fl">15.5784</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Next use <code><a href="../reference/get_wth.html">get_wth()</a></code> to fetch the weather data from the <a href="https://power.larc.nasa.gov">POWER API</a>. With the list of locations, <code>locations</code>, use <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code> to fetch all of the locations with one function. You could also use R’s base <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> here as well if you prefer.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/adamhsparks/epicrop/">"epicrop"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://purrr.tidyverse.org">"purrr"</a></span><span class="op">)</span>

<span class="va">locations_wth</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">locations</span>,
    .f <span class="op">=</span> <span class="va">get_wth</span>,
    dates <span class="op">=</span> <span class="st">"2000-06-30"</span>,
    duration <span class="op">=</span> <span class="fl">120</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="simulating-multiple-locations-with-purrr" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating-multiple-locations-with-purrr" class="anchor"></a>Simulating multiple locations with <em>purrr</em>
</h3>
<p>This behaviour would be the same as if you used R’s base <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> here as well. The process for using <em>furrr</em> won’t be shown here, but to implement several locations or year locations and planting date simulations in parallel would be as shown above.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://lubridate.tidyverse.org">"lubridate"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span>

<span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>
  .x <span class="op">=</span> <span class="va">locations_wth</span>,
  .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/predict_bacterial_blight.html">predict_bacterial_blight</a></span><span class="op">(</span>emergence <span class="op">=</span> <span class="va">.x</span><span class="op">$</span><span class="va">YYYYMMDD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
                                  wth <span class="op">=</span> <span class="va">.x</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"location"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">location</span>, <span class="va">AUDPC</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">AUDPC</span>, <span class="va">location</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">AUDPC</span>,
    xend <span class="op">=</span> <span class="fl">0</span>,
    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span>,
    yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">rev</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Location"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="run-multi-loc-1.png" alt=""><p class="caption">Rice bacterial blight area under the disease progress curve (AUDPC) values for an establishment date of June 30, 2000 at five locations, Mekong River Delta and Red River Delta in Vietnam; Prachin Buri, Thailand; Chennai, India and Nueva Ecija, in the Philippines.</p>
</div>
</div>
</div>
<div id="benchmarking-sequential-versus-parallel-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#benchmarking-sequential-versus-parallel-methods" class="anchor"></a>Benchmarking sequential versus parallel methods</h2>
<p>It is possible to measure the effect of running the simulations in parallel as compared to sequentially using the <em>microbenchmark</em> package. Here an example of how to use benchmarking is shown using the second set of examples showing how to simulate multiple establishment dates with the already created objects from those examples.</p>
<p>Greater gains in efficiency will be realised with more dates, locations, etc. when running in parallel than sequentially.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/joshuaulrich/microbenchmark/">"microbenchmark"</a></span><span class="op">)</span>

<span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="va">mbm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span>
  sequential <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">wth</span>,
    .y <span class="op">=</span> <span class="va">emergence_dates</span>,
    .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/predict_bacterial_blight.html">predict_bacterial_blight</a></span><span class="op">(</span>emergence <span class="op">=</span> <span class="va">.y</span>,
                                    wth <span class="op">=</span> <span class="va">.x</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"emergence"</span><span class="op">)</span>,
  parallel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/future_map2.html">future_map2</a></span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">wth</span>,
    .y <span class="op">=</span> <span class="va">emergence_dates</span>,
    .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/predict_bacterial_blight.html">predict_bacterial_blight</a></span><span class="op">(</span>emergence <span class="op">=</span> <span class="va">.y</span>,
                              wth <span class="op">=</span> <span class="va">.x</span><span class="op">)</span>,
    .options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/furrr/man/furrr_options.html">furrr_options</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"emergence"</span><span class="op">)</span>,
  unit <span class="op">=</span> <span class="st">"relative"</span>
<span class="op">)</span>
<span class="co">#&gt; Error in match.arg(unit, values): 'arg' should be one of "nanoseconds", "ns", "microseconds", "us", "milliseconds", "ms", "seconds", "s", "secs", "time", "t", "frequency", "f", "hz", "khz", "mhz", "eps"</span>

<span class="va">mbm</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'mbm' not found</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">mbm</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in autoplot(mbm): object 'mbm' not found</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Adam H. Sparks, Robert Hijmans, Serge Savary, Ireno Pangga, Jorrel Aunario.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
